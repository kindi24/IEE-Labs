#include <main.h>
#byte PORTB =0xF81     
#byte PORTC =0xF82 
#byte PORTD =0xF83 

void main(){
   // Καθορισμός της πόρτας Β ως εισόδου
   // Καθορισμός της πόρτας C ως εξόδου
   // Καθορισμός της πόρτας D ως εξόδου
   set_tris_b(0xFF);
   set_tris_c(0x00);
   set_tris_d(0x00);

   int8 table[16] ={ 
   //Πίνακας με του κώδικες για εμφάνιση σε ενδείκτη 7 τομέων
         0b00111111, //κώδικας για εμφάνιση του 0  
         0b00000110, //κώδικας για εμφάνιση του 1
         0b01011011, //κώδικας για εμφάνιση του 2
         0b01001111, //κώδικας για εμφάνιση του 3
         0b01100110, //κώδικας για εμφάνιση του 4
         0b01101101, //κώδικας για εμφάνιση του 5
         0b01111101, //κώδικας για εμφάνιση του 6
         0b00000111, //κώδικας για εμφάνιση του 7
         0b01111111, //κώδικας για εμφάνιση του 8
         0b01101111, //κώδικας για εμφάνιση του 9
         0b01110111, //κώδικας για εμφάνιση του Α
         0b01111100, //κώδικας για εμφάνιση του Β
         0b00111001, //κώδικας για εμφάνιση του C
         0b01011110, //κώδικας για εμφάνιση του D
         0b01111001, //κώδικας για εμφάνιση του Ε
         0b01110001};//κώδικας για εμφάνιση του F

   int isodos;        // μεταβλητή για αποθήκευση της τιμής εισόδου
   int monades;       // μεταβλητή για αποθήκευση των μονάδων της τιμής εισόδου
   int decades;       // μεταβλητή για αποθήκευση των δεκάδων της τιμής εισόδου
   int ekatontades;   // τιμή για αποθήκευση των εκατοντάδων της τιμής εισόδου


    while (TRUE){           
      // οι κώδικες του κάθε ψηφίου στέλνονται κάθε 5 ms
      // με ενεργοποίηση του αντίστοιχου ενδείκτη
      //διαβάζουμε την τιμή της PORTB
      isodos=PORTB;
      // υπολογισμός των εκατοντάδων της τιμής της πόρτας Β
      ekatontades=isodos/100;
      // υπολογισμός των δεκάδων της τιμής της πόρτας Β
      decades=(isodos-ekatontades*100)/10; 
      //υπολογισμός των μονάδων της τιμής της πόρτας Β
      monades =isodos-ekatontades*100-decades*10; 

      //……Εμφάνιση των εκατοντάδων    ……………………………………………………………………….
      PORTC=0b00000100;         //ενεργοποίηση του αριστερά ενδείκτη
      PORTD=table[ekatontades];   //αποστολή του κώδικα για εμφάνιση των εκατοντάδων
      delay_ms(5);                     //αναμονή για 5 ms

      //…….Εμφάνιση των δεκάδων   ………………………………
      PORTC=0b00000010;        // ενεργοποίηση του μεσαίου ενδείκτη
      PORTD=table[decades];     //αποστολή του κώδικα για εμφάνιση των δεκάδων
      delay_ms(5);               //αναμονή για 5 ms

      //………Εμφάνιση των μονάδων   ……………………………….            
      PORTC=0b00000001;  //ενεργοποίηση του δεξιά ενδείκτη
      PORTD=table[monades];  //αποστολή του κώδικα για εμφάνιση των μονάδων
      delay_ms(5);   //αναμονή για 5 ms
    }
}
